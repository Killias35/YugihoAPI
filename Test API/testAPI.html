<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>WebSocket Debug Tool</title>
  <style>
    body {
      font-family: monospace;
      background-color: #1e1e1e;
      color: #f1f1f1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    input, textarea, button {
      font-family: monospace;
      margin: 10px 0;
      padding: 10px;
      border: none;
      border-radius: 4px;
      width: 100%;
      max-width: 500px;
    }

    input, textarea {
      background-color: #2e2e2e;
      color: #f1f1f1;
    }

    button {
      background-color: #007acc;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #005a99;
    }

    #log {
      background-color: #111;
      border: 1px solid #444;
      padding: 10px;
      width: 100%;
      max-width: 600px;
      height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h2>üîß Test WebSocket Yu-Gi-Oh! API</h2>

  <input id="tokenInput" placeholder="üîë Entre ton token ici" />

  <button onclick="connectSocket()">üîå Se connecter</button>
  <button onclick="disconnectSocket()">‚ùå D√©connecter</button>

  <textarea id="jsonInput" rows="6" placeholder='üì§ Entre ton JSON ici, ex: {"action": "duel", "target": "Seto Kaiba"}'></textarea>

  <button onclick="sendMessage()">üì® Envoyer</button>

  <div id="log">üìù Log :</div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    let socket = null;

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const color = type === 'error' ? 'red' : type === 'success' ? 'lime' : '#f1f1f1';
      logDiv.innerHTML += `<div style="color: ${color}">${message}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function connectSocket() {
      const token = document.getElementById('tokenInput').value.trim();
      if (!token) return log("‚ö†Ô∏è Token manquant", 'error');

      socket = io("http://localhost:8080", {
        auth: { token }
      });

      socket.on("connect", () => {
        log("‚úÖ Connect√© avec succ√®s", 'success');
      });

      socket.on("disconnect", () => {
        log("‚ùå D√©connect√© du serveur", 'error');
      });

      socket.onAny((event, data) => {
        log(`üì• Re√ßu [${event}] :\n${JSON.stringify(data, null, 2)}`);
      });

      socket.on("connect_error", (err) => {
        log(`‚ùó Erreur de connexion : ${err.message}`, 'error');
      });
    }

    function disconnectSocket() {
      if (socket) {
        socket.disconnect();
        socket = null;
        log("üîå Socket ferm√©");
      }
    }

    function sendMessage() {
      if (!socket || !socket.connected) {
        return log("‚ùó Socket non connect√©", 'error');
      }

      const raw = document.getElementById('jsonInput').value.trim();
      if (!raw) return;

      try {
        const json = JSON.parse(raw);
        socket.emit("gameAction", json);
        log(`üì§ Envoy√© : ${JSON.stringify(json)}`, 'success');
      } catch (err) {
        log("‚ùó JSON invalide : " + err.message, 'error');
      }
    }
  </script>

</body>
</html>
